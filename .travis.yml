os: windows
language: shell

env:
  global:
    - GOVERSION: 1.12.10
    - NODEJS_VERSION: 11.14.0

before_install:
  - git clone https://github.com/portapps/portapps ${TRAVIS_BUILD_DIR}/../portapps
  - source ${TRAVIS_BUILD_DIR}/../portapps/.travis/prepare.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/java.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/ant.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/nodejs.sh
  - bash ${TRAVIS_BUILD_DIR}/../portapps/.travis/go.sh

script:
  - ant release

after_success:
  - export APP_VERSION=$(cat $TRAVIS_BUILD_DIR/bin/tmp/version.dat)
  - echo ${APP_VERSION}

before_deploy:
  - git config --local user.email "builds@travis-ci.com"
  - git config --local user.name "Travis CI"
  - export TRAVIS_TAG="${APP_VERSION}"
  - git tag $TRAVIS_TAG
  - ls -al bin/release

deploy:
  provider: releases
  api_key:
    secure: A+mPb5npqMKZIL5QKnkVzCskO8qRFYWbgsi+8KqgCVb1d7ZlRxDVA5/Fc0L7HNVcf28uwO7uNYiZqqjhiym2pWpGqpT6Kr+wQn60jaynV123cbdXlVMX+I4AKB1p2UU7ooX5oG/SCsG81NJkjoV9LJ7twhUmkfzLbi97R1ZK0PuvtvLLMvUtB5OnwUgiMQRNwN+Wmk05KqRHP55mU33HNQNstg2R79lCqikYleQWo6jg/5OjACxqxgz5MykYnBzyENlofDpI80mcVsaRTv5nVr9CcbaI7v3zS5n2tgZvVpyRQLJUr86Sp52ZZd5kPUgSIpucEJVqnK+iQeMhi+cDOgC2Jqdp06vTGmN1Fzq1zfpuoVdBl9TUeKWFchnyvvRrF3LUrm6s4+1VEvgkMM+gW0ka7Qr9rWWXpMe1LXwayFik9wHo2LxIKoUZ9ZvHEuNMPy/BDilwibZsMz9exnk3vpW8tGMR3K0r7Imav7j/Wi8K34eqPVIUtedrsH264i7rvIxhWVDN2vgRauYUKdb+nVVYqlZ4pU1oL4oSo1DeysnQwVnOgAplbQyVRw78zaFDZev2BU1XkmRYqiQvk6e9Rd2i9t+KMyhGUFeF+TUV0UYj0cwnDUgHq4LQzHC3urLVMNN6miCMp7dGoyNLTbbUywTVoXXIwNH7jY+NhEiwJZU=
  file_glob: true
  file: bin/release/*
  skip_cleanup: true
  draft: true
  on:
    tags: false
